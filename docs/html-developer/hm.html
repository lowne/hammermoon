<html>
<title>hm - Hammermoon documentation</title>
<meta charset="UTF-8">
<link href="docs.css" rel="stylesheet" type="text/css">
<link href="rainbow.css" rel="stylesheet" type="text/css">
<body>
<a name="//apple_ref/cpp/Module/hm" class="dashAnchor"></a><h1 id="hm">Module <code>hm</code></h1><blockquote>INTERNAL CHANGE: <span class=short>Using the 'checks' library for userscript argument checking.
Using the 'compat53' library, but syntax-level things (such as # not using <em></em>len) are still Lua 5.1</p></blockquote><span class=short>Hammermoon main module</p><p class=long></p><h2>Overview</h2><dl><dt>Global fields</dt><dd><a href=hm.html#hm><code>hm</code></a> : <a href=hm.html#hm><em><code>&lt;#hm&gt;</code></em></a> - global field</dd><dd><a href=hm.html#hmassert><code>hmassert</code></a> : <em><code>&lt;?&gt;</code></em> - global field</dd><dd><a href=hm.html#hmassertf><code>hmassertf</code></a> : <em><code>&lt;?&gt;</code></em> - global field</dd><dd><a href=hm.html#hs><code>hs</code></a> : <em><code>&lt;?&gt;</code></em> - global field</dd></dl><dl><dt>Module <a href=hm.html#hm><code>hm</code></a></dt><dd><a href=hm.html#hm-_core><code>_core</code></a> : <a href=hm.html#hm._core><em><code>&lt;#hm._core&gt;</code></em></a> - field</dd><dd><a href=hm.html#hm-debug><code>debug</code></a> : <a href=hm.html#hm.debug><em><code>&lt;#hm.debug&gt;</code></em></a> - field</dd><dd><a href=hm.html#hm-quit><code>quit()</code></a> - function</dd><dd><a href=hm.html#hm-type><code>type(obj)</code></a> &ndash;&rsaquo; <em><code>&lt;#string&gt;</code></em> - function</dd></dl><dl><dt>Class <a href=hm.html#module><code>module</code></a></dt><dd><a href=hm.html#module-_classes><code>_classes</code></a> : <code>{ [</code><em><code>&lt;#string&gt;</code></em><code>] = </code><a href=hm.html#module.class><em><code>&lt;#module.class&gt;</code></em></a><code>, ...}</code> - field</dd><dd><a href=hm.html#module-log><code>log</code></a> : <a href=hm.logger.html#logger><em><code>&lt;hm.logger#logger&gt;</code></em></a> - field</dd><dd><a href=hm.html#module-__gc><code>__gc()</code></a> - function</dd></dl><dl><dt>Class <a href=hm.html#module.class><code>module.class</code></a></dt><dd><a href=hm.html#module.class-_new><code>_new(t,name)</code></a> &ndash;&rsaquo; <a href=hm.html#module.object><em><code>&lt;#module.object&gt;</code></em></a> - function</dd></dl><dl><dt>Class <a href=hm.html#module.object><code>module.object</code></a></dt><dd><a href=hm.html#module.object-log><code>log</code></a> : <a href=hm.logger.html#logger><em><code>&lt;hm.logger#logger&gt;</code></em></a> - field</dd></dl><dl><dt>Table <a href=hm.html#hm._core><code>hm._core</code></a></dt><dd><a href=hm.html#hm._core-log><code>log</code></a> : <a href=hm.logger.html#logger><em><code>&lt;hm.logger#logger&gt;</code></em></a> - field</dd><dd><a href=hm.html#hm._core-rawrequire><code>rawrequire</code></a> : <em><code>&lt;?&gt;</code></em> - field</dd><dd><a href=hm.html#hm._core-cacheKeys><code>cacheKeys()</code></a> - function</dd><dd><a href=hm.html#hm._core-cacheValues><code>cacheValues()</code></a> - function</dd><dd><a href=hm.html#hm._core-deprecate><code>deprecate(module,fieldname,replacement)</code></a> - function</dd><dd><a href=hm.html#hm._core-disallow><code>disallow(module,fieldname,replacement)</code></a> - function</dd><dd><a href=hm.html#hm._core-module><code>module(name,classes,submodules)</code></a> &ndash;&rsaquo; <a href=hm.html#module><em><code>&lt;#module&gt;</code></em></a> - function</dd><dd><a href=hm.html#hm._core-property><code>property(module,fieldname,getter,setter,type,sanitize)</code></a> - function</dd><dd><a href=hm.html#hm._core-retainKeys><code>retainKeys()</code></a> - function</dd><dd><a href=hm.html#hm._core-retainValues><code>retainValues()</code></a> - function</dd></dl><dl><dt>Table <a href=hm.html#hm.debug><code>hm.debug</code></a></dt><dd><a href=hm.html#hm.debug-cacheUIElements><code>cacheUIElements</code></a> : <em><code>&lt;#boolean&gt;</code></em> - field</dd><dd><a href=hm.html#hm.debug-disableAssertions><code>disableAssertions</code></a> : <em><code>&lt;#boolean&gt;</code></em> - field</dd><dd><a href=hm.html#hm.debug-disableTypeChecks><code>disableTypeChecks</code></a> : <em><code>&lt;#boolean&gt;</code></em> - field</dd><dd><a href=hm.html#hm.debug-retainUserObjects><code>retainUserObjects</code></a> : <em><code>&lt;#boolean&gt;</code></em> - field</dd></dl><br><h2>Global fields</h2><a name="//apple_ref/cpp/Global/hm" class="dashAnchor"></a><h3 id="hm">Global field <code>hm</code>: <a href=hm.html#hm><em><code>&lt;#hm&gt;</code></em></a></h3><span class=short>Hammermoon's namespace, globally accessible from userscripts</p><p class=long></p><a name="//apple_ref/cpp/Global/hmassert" class="dashAnchor"></a><h3 id="hmassert">Global field <code>hmassert</code>: <em><code>&lt;?&gt;</code></em></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Global/hmassertf" class="dashAnchor"></a><h3 id="hmassertf">Global field <code>hmassertf</code>: <em><code>&lt;?&gt;</code></em></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Global/hs" class="dashAnchor"></a><h3 id="hs">Global field <code>hs</code>: <em><code>&lt;?&gt;</code></em></h3><span class=short>For compatibility with Hammerspoon userscripts</p><p class=long></p><br><br><a name="//apple_ref/cpp/Module/hm" class="dashAnchor"></a><h2 id="hm">Module <code>hm</code></h2><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Field/hm._core" class="dashAnchor"></a><h3 id="hm-_core">Field <code>hm._core</code>: <a href=hm.html#hm._core><em><code>&lt;#hm._core&gt;</code></em></a></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Field/hm.debug" class="dashAnchor"></a><h3 id="hm-debug">Field <code>hm.debug</code>: <a href=hm.html#hm.debug><em><code>&lt;#hm.debug&gt;</code></em></a></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Function/hm.quit" class="dashAnchor"></a><h3 id="hm-quit">Function <code>hm.quit()</code></h3><span class=short>Quits Hammermoon.</p><p class=long>This function will make sure to properly close the Lua state, so that all the <em></em>gc metamethods will run.</p><a name="//apple_ref/cpp/Function/hm.type" class="dashAnchor"></a><h3 id="hm-type">Function <code>hm.type(obj)</code> &ndash;&rsaquo; <em><code>&lt;#string&gt;</code></em></h3><span class=short>Returns the Hammermoon type of an object.</p><ul><li> <code>obj</code>: <em><code>&lt;?&gt;</code></em> <span class=short>object to get the type of</p></li></ul><ul><li>Returns <em><code>&lt;#string&gt;</code></em>: <span class=short>the object type</p></li></ul><p class=long>If <code>obj</code> is an Hammermoon <a href="hm.html#module"><em><code><#module></code></em></a>, <a href="hm.html#module.class"><em><code><#module.class></code></em></a>, or <a href="hm.html#module.object"><em><code><#module.object></code></em></a>, this function will return its type name
instead of the generic <code>"table"</code>. In all other cases this function behaves like Lua's <code>type()</code>.</p><br><a name="//apple_ref/cpp/Class/&lt;#module&gt;" class="dashAnchor"></a><h2 id="module">Class <code>module</code></h2><blockquote>Defines type checker <code>hm#module</code></blockquote><span class=short>Type for Hammermoon modules.</p><p class=long>Hammermoon modules (usually created via <code>hm._core.module()</code>) can be <code>require</code>d normally
(<code>local somemod=require'hm.somemod'</code>) or loaded directly via the the global <code>hm</code> namespace
(<code>hm.somemod.somefn(...)</code>).</p><a name="//apple_ref/cpp/Field/&lt;#module&gt;._classes" class="dashAnchor"></a><h3 id="module-_classes">Field <code>&lt;#module&gt;._classes</code>: <code>{ [</code><em><code>&lt;#string&gt;</code></em><code>] = </code><a href=hm.html#module.class><em><code>&lt;#module.class&gt;</code></em></a><code>, ...}</code></h3><span class=short>The classes (i.e., object metatables) declared by this module</p><p class=long></p><a name="//apple_ref/cpp/Field/&lt;#module&gt;.log" class="dashAnchor"></a><h3 id="module-log">Field <code>&lt;#module&gt;.log</code>: <a href=hm.logger.html#logger><em><code>&lt;hm.logger#logger&gt;</code></em></a></h3><span class=short>The extension's module-level logger instance</p><p class=long></p><a name="//apple_ref/cpp/Function/&lt;#module&gt;.__gc" class="dashAnchor"></a><h3 id="module-__gc">Function <code>&lt;#module&gt;.__gc()</code></h3><blockquote><strong>Internal/advanced use only</strong></blockquote><span class=short>Implement this function to perform any required cleanup when a module is unloaded</p><p class=long></p><br><a name="//apple_ref/cpp/Class/&lt;#module.class&gt;" class="dashAnchor"></a><h2 id="module.class">Class <code>module.class</code></h2><blockquote><strong>Internal/advanced use only</strong></blockquote><blockquote>Defines type checker <code>hm#module.class</code></blockquote><span class=short>Type for Hammermoon object classes</p><p class=long></p><a name="//apple_ref/cpp/Function/&lt;#module.class&gt;._new" class="dashAnchor"></a><h3 id="module.class-_new">Function <code>&lt;#module.class&gt;._new(t,name)</code> &ndash;&rsaquo; <a href=hm.html#module.object><em><code>&lt;#module.object&gt;</code></em></a></h3><blockquote><strong>Internal/advanced use only</strong></blockquote><span class=short>Create a new instance.</p><ul><li> <code>t</code>: <em><code>&lt;#table&gt;</code></em> <span class=short>initial values for the new object</p></li><li> <code>name</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>(optional) if provided, the object will have its own logger instance with the given name</p></li></ul><ul><li>Returns <a href=hm.html#module.object><em><code>&lt;#module.object&gt;</code></em></a>: <span class=short>a new object instance</p></li></ul><p class=long>Objects created by this function have their lifecycle tracked by Hammermoon's core.</p><br><a name="//apple_ref/cpp/Class/&lt;#module.object&gt;" class="dashAnchor"></a><h2 id="module.object">Class <code>module.object</code></h2><blockquote><strong>Internal/advanced use only</strong></blockquote><span class=short>Type for Hammermoon objects</p><p class=long></p><a name="//apple_ref/cpp/Field/&lt;#module.object&gt;.log" class="dashAnchor"></a><h3 id="module.object-log">Field <code>&lt;#module.object&gt;.log</code>: <a href=hm.logger.html#logger><em><code>&lt;hm.logger#logger&gt;</code></em></a></h3><span class=short>the object logger (only if created with a name)</p><p class=long></p><br><a name="//apple_ref/cpp/Record/hm._core" class="dashAnchor"></a><h2 id="hm._core">Table <code>hm._core</code></h2><blockquote><strong>Internal/advanced use only</strong></blockquote><span class=short>Hammermoon core facilities for use by extensions.</p><p class=long></p><a name="//apple_ref/cpp/Field/hm._core.log" class="dashAnchor"></a><h3 id="hm._core-log">Field <code>hm._core.log</code>: <a href=hm.logger.html#logger><em><code>&lt;hm.logger#logger&gt;</code></em></a></h3><span class=short>Logger instance for Hammermoon's core</p><p class=long></p><a name="//apple_ref/cpp/Field/hm._core.rawrequire" class="dashAnchor"></a><h3 id="hm._core-rawrequire">Field <code>hm._core.rawrequire</code>: <em><code>&lt;?&gt;</code></em></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Function/hm._core.cacheKeys" class="dashAnchor"></a><h3 id="hm._core-cacheKeys">Function <code>hm._core.cacheKeys()</code></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Function/hm._core.cacheValues" class="dashAnchor"></a><h3 id="hm._core-cacheValues">Function <code>hm._core.cacheValues()</code></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Function/hm._core.deprecate" class="dashAnchor"></a><h3 id="hm._core-deprecate">Function <code>hm._core.deprecate(module,fieldname,replacement)</code></h3><blockquote><strong>API CHANGE:</strong> <span class=short>Doesn't exist in Hammerspoon</p></blockquote><blockquote>INTERNAL CHANGE: <span class=short>Deprecation facility</p></blockquote><span class=short>Deprecate a field or function of a module or class</p><ul><li> <code>module</code>: <a href=hm.html#module><em><code>&lt;#module&gt;</code></em></a> <span class=short><a href="hm.html#module"><em><code><#module></code></em></a> table or <a href="hm.html#module.class"><em><code><#module.class></code></em></a> table</p></li><li> <code>fieldname</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>field or function name</p></li><li> <code>replacement</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>the replacement field or function to direct users to</p></li></ul><p class=long></p><a name="//apple_ref/cpp/Function/hm._core.disallow" class="dashAnchor"></a><h3 id="hm._core-disallow">Function <code>hm._core.disallow(module,fieldname,replacement)</code></h3><blockquote><strong>API CHANGE:</strong> <span class=short>Doesn't exist in Hammerspoon</p></blockquote><blockquote>INTERNAL CHANGE: <span class=short>Deprecation facility</p></blockquote><span class=short>Disallow a field or function of a module or class (after deprecation)</p><ul><li> <code>module</code>: <a href=hm.html#module><em><code>&lt;#module&gt;</code></em></a> <span class=short><a href="hm.html#module"><em><code><#module></code></em></a> table or <a href="hm.html#module.class"><em><code><#module.class></code></em></a> table</p></li><li> <code>fieldname</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>field or function name</p></li><li> <code>replacement</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>the replacement field or function to direct users to</p></li></ul><p class=long></p><a name="//apple_ref/cpp/Function/hm._core.module" class="dashAnchor"></a><h3 id="hm._core-module">Function <code>hm._core.module(name,classes,submodules)</code> &ndash;&rsaquo; <a href=hm.html#module><em><code>&lt;#module&gt;</code></em></a></h3><blockquote><strong>API CHANGE:</strong> <span class=short>Doesn't exist in Hammerspoon</p></blockquote><blockquote>INTERNAL CHANGE: <span class=short>Allows allocation tracking, properties, deprecation; handled by core</p></blockquote><span class=short>Declare a new Hammermoon module.</p><ul><li> <code>name</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>module name (without the <code>"hm."</code> prefix)</p></li><li> <code>classes</code>: <em><code>&lt;#table&gt;</code></em> <span class=short>a map with the initial metatables (as values) for the module's classes (whose names are the map's keys),
if any; the metatables can can contain <code><strong>tostring</code>, <code></strong>eq</code>, <code><em></em>gc</code>, etc. This table, suitably instrumented, will be
available in the resuling module's <code>_classes</code> field</p></li><li> <code>submodules</code>: <em><code>&lt;#table&gt;</code></em> <span class=short>a plain list of submodule names, if any, that will be automatically required as the respective
fields in this module are accessed</p></li></ul><ul><li>Returns <a href=hm.html#module><em><code>&lt;#module&gt;</code></em></a>: <span class=short>the "naked" table for the new module, ready to be filled with functions</p></li></ul><p class=long>Use this function to create the table for your module.
If your module instantiates objects, you should pass <code>classes</code> (the values can just be empty tables),
and retrieve the metatable for your objects (and the constructor) via the <code><em>classes[<CLASSNAME>]</code> field
of the returned module table. Note that the <code></em><em>gc</code> metamethod of a class, if used, must be </em>already*
in the class table passed to this function (i.e. you cannot add it afterwards) for Hammermoon's allocation debugging to work.</p><strong>Usage:</strong><br><pre><code class="language-lua">local mymodule=hm._core.module('mymodule',{myclass={}})
local myclass=mymodule._classes.myclass
function mymodule.myfunction(param) ... end
function mymodule.construct(args) ... return myclass._new(...) end
function myclass:mymethod() ... end
...
return mymodule -- at the end of the file</code></pre><a name="//apple_ref/cpp/Function/hm._core.property" class="dashAnchor"></a><h3 id="hm._core-property">Function <code>hm._core.property(module,fieldname,getter,setter,type,sanitize)</code></h3><blockquote><strong>API CHANGE:</strong> <span class=short>Doesn't exist in Hammerspoon; this also allows fields in modules and objects to be trivially type-checked.</p></blockquote><blockquote>INTERNAL CHANGE: <span class=short>Modules don't need to handle properties internally.</p></blockquote><span class=short>Add a property to a module or class.</p><ul><li> <code>module</code>: <a href=hm.html#module><em><code>&lt;#module&gt;</code></em></a> <span class=short><a href="hm.html#module"><em><code><#module></code></em></a> table or <a href="hm.html#module.class"><em><code><#module.class></code></em></a> table</p></li><li> <code>fieldname</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>desired field name</p></li><li> <code>getter</code>: <em><code>&lt;#function&gt;</code></em> <span class=short>getter function</p></li><li> <code>setter</code>: <em><code>&lt;#function&gt;</code></em> <span class=short>setter function; if <code>false</code> the property is read-only; if <code>nil</code> the property is
       immutable and will be cached after the first query.</p></li><li> <code>type</code>: <em><code>&lt;#string&gt;</code></em> <span class=short>field type (for writable fields)</p></li><li> <code>sanitize</code>: <em><code>&lt;#boolean&gt;</code></em> <span class=short>if <code>true</code>, use <code>sanitizeargs</code> instead of <code>checkargs</code></p></li></ul><p class=long>This function will add to the module or class a user-facing field that uses custom getter and setter.</p><a name="//apple_ref/cpp/Function/hm._core.retainKeys" class="dashAnchor"></a><h3 id="hm._core-retainKeys">Function <code>hm._core.retainKeys()</code></h3><span class=short></p><p class=long></p><a name="//apple_ref/cpp/Function/hm._core.retainValues" class="dashAnchor"></a><h3 id="hm._core-retainValues">Function <code>hm._core.retainValues()</code></h3><span class=short></p><p class=long></p><br><a name="//apple_ref/cpp/Record/hm.debug" class="dashAnchor"></a><h2 id="hm.debug">Table <code>hm.debug</code></h2><blockquote><strong>Internal/advanced use only</strong></blockquote><blockquote><strong>API CHANGE:</strong> <span class=short>Doesn't exist in Hammerspoon</p></blockquote><span class=short>Debug options</p><p class=long></p><a name="//apple_ref/cpp/Field/hm.debug.cacheUIElements" class="dashAnchor"></a><h3 id="hm.debug-cacheUIElements">Field <code>hm.debug.cacheUIElements</code>: <em><code>&lt;#boolean&gt;</code></em></h3><blockquote>INTERNAL CHANGE: <span class=short>Uielements are cached</p></blockquote><span class=short>Cache uielement objects (default <code>true</code>).</p><p class=long>Uielement objects (including applications and windows) are cached internally for performance; this can be disabled.</p><a name="//apple_ref/cpp/Field/hm.debug.disableAssertions" class="dashAnchor"></a><h3 id="hm.debug-disableAssertions">Field <code>hm.debug.disableAssertions</code>: <em><code>&lt;#boolean&gt;</code></em></h3><blockquote>INTERNAL CHANGE: <span class=short>Centralized switch for assertion checking - Hammermoon modules should all use <code>hmassert()</code></p></blockquote><span class=short>Disable assertions (default <code>false</code>).</p><p class=long>If set to <code>true</code>, assertions are disabled for slightly better performance.</p><a name="//apple_ref/cpp/Field/hm.debug.disableTypeChecks" class="dashAnchor"></a><h3 id="hm.debug-disableTypeChecks">Field <code>hm.debug.disableTypeChecks</code>: <em><code>&lt;#boolean&gt;</code></em></h3><blockquote>INTERNAL CHANGE: <span class=short>Centralized switch for type checking - Hammermoon modules should all use <code>hmcheck()</code></p></blockquote><span class=short>Disable type checks (default <code>false</code>).</p><p class=long>If set to <code>true</code>, type checks are disabled for slightly better performance.</p><a name="//apple_ref/cpp/Field/hm.debug.retainUserObjects" class="dashAnchor"></a><h3 id="hm.debug-retainUserObjects">Field <code>hm.debug.retainUserObjects</code>: <em><code>&lt;#boolean&gt;</code></em></h3><blockquote>INTERNAL CHANGE: <span class=short>User objects are retained</p></blockquote><span class=short>Retain user objects internally (default <code>true</code>).</p><p class=long>User objects (timers, watchers, etc.) are retained internally by default, so
userscripts needn't worry about their lifecycle.
If falsy, they will get gc'ed unless the userscript keeps a global reference.</p><br>
<script src="rainbow.js"></script>
</body>
</html>
